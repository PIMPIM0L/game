<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Questions - Admin Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header class="navbar">
    <div class="logo"><a href="/admin/dashboard" style="text-decoration: none;" >üéØ Emoji Game</a></div>
    <div class="dropdown">
      <button class="dropbtn">‚ò∞ ‡πÄ‡∏°‡∏ô‡∏π</button>
      <div class="dropdown-content">
        <a href="/admin/reports">üìà Reports</a>
        <a href="/admin/questions">‚ùì Questions</a>
        <a href="/logout">üö™ Sign out</a>
      </div>
    </div>
  </header>

  <h1>‚ùì Manage Questions</h1>

  <% if (success) { %>
    <div class="success"><%= success %></div>
  <% } %>

  <% if (error) { %>
    <div class="error"><%= error %></div>
  <% } %>

  <!-- Add Question Form -->
  <div class="add-question-form">
    <h2 style="margin-bottom: 20px;">Add New Question</h2>
    <form action="/admin/questions/add" method="POST" autocomplete="off">
      <div class="form-row">
        <div class="form-group">
          <input 
            type="text" 
            id="emojis" 
            name="emojis" 
            placeholder="Emojis" 
            required>
        </div>

        <div class="form-group">
          <input 
            type="text" 
            id="answer" 
            name="answer" 
            placeholder="Answer" 
            required>
        </div>
      </div>
      <button type="submit" class="btn-add">‚ûï Add Question</button>
    </form>
  </div>

  <!-- Questions List -->
  <h2 style="margin: 40px 0 20px 0;">All Questions (<%= questions.length %>)</h2>

  <% if (questions.length === 0) { %>
    <div style="text-align: center; padding: 50px; background: #f8f9ff; border-radius: 15px;">
      <p style="font-size: 1.2em; color: #666;">
        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
      </p>
    </div>
  <% } else { %>
    <% questions.forEach(question => { %>
      <div class="question-item">
        <div class="question-content">
          <div class="question-emojis"><%= question.emojis %></div>
          <div class="question-answer">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: <%= question.answer %></div>
          <small style="color: #999;">ID: <%= question.id %></small>
        </div>

        <div class="question-actions">
          <!-- Edit button -->
          <button 
            class="edit-btn"
            style="background: #6c63ff; color: white; cursor: pointer;"
            onclick="openEditModal(<%= question.id %>, '<%= question.emojis %>', '<%= question.answer %>')">
            ‚úèÔ∏è Edit
          </button>

          <!-- ‚úÖ Delete button (fixed POST form) -->
          <form 
            action="/admin/questions/delete/<%= question.id %>" 
            method="POST" 
            class="delete-form"
            onsubmit="return confirmDelete(event)">
            <button 
              class="delete-btn"
              style="background:#e74c3c; color:white; cursor:pointer;">
              üóëÔ∏è Delete
            </button>
          </form>
        </div>
      </div>
    <% }) %>
  <% } %>

  <!-- Edit Modal -->
  <div id="editModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h2>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h2>
      <form id="editForm" method="POST">
        <div class="form-group">
          <label for="edit-emojis">Emojis</label>
          <input type="text" id="edit-emojis" name="emojis" required>
        </div>

        <div class="form-group">
          <label for="edit-answer">Answer</label>
          <input type="text" id="edit-answer" name="answer" required>
        </div>

        <div class="modal-buttons">
          <button type="submit" style="background:#6c63ff; color:white;">üíæ Save</button>
          <button type="button" onclick="closeModal()">‚ùå Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    function openEditModal(id, emojis, answer) {
      const modal = document.getElementById('editModal');
      modal.style.display = 'block';
      document.getElementById('editForm').action = `/admin/questions/edit/${id}`;
      document.getElementById('edit-emojis').value = emojis;
      document.getElementById('edit-answer').value = answer;
    }

    // ‡∏õ‡∏¥‡∏î modal
    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å‡∏Å‡∏£‡∏≠‡∏ö
    window.onclick = function(e) {
      const modal = document.getElementById('editModal');
      if (e.target === modal) closeModal();
    }

    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô double delete / reload ‡∏´‡∏•‡∏±‡∏á POST
    function confirmDelete(e) {
      const confirmDelete = confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ?');
      if (!confirmDelete) {
        e.preventDefault();
        return false;
      }
    }
  </script>
</body>
</html>
